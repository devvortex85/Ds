{% extends "core/base.html" %}
{% load user_guide_filters %}

{% block title %}User Guide - {{ guide_type|title }}{% endblock %}

{% block content %}
<div class="container my-4">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h2 class="mb-0">{{ guide_type|title|replace:"_: " }} Guide</h2>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <p>Click the buttons below to navigate through the guide. This is an interactive tutorial that will help you understand how to use the Discuss platform.</p>
                    </div>
                    
                    <div class="guide-navigation mb-4">
                        <button id="guide-start" class="btn btn-primary">Start Guide</button>
                        <button id="guide-prev" class="btn btn-secondary" disabled>Previous</button>
                        <button id="guide-next" class="btn btn-secondary">Next</button>
                        <button id="guide-close" class="btn btn-danger">Close Guide</button>
                    </div>
                    
                    <div class="guide-steps">
                        {% for step in steps %}
                        <div class="guide-step" id="step-{{ step.order }}" style="display: {% if forloop.first %}block{% else %}none{% endif %};">
                            <h3>{{ step.title }}</h3>
                            <p>{{ step.content }}</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            
            <div class="card mt-4">
                <div class="card-header bg-light">
                    <h3 class="mb-0">Other Guides</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <a href="{% url 'user_guide' 'new_user' %}" class="btn btn-outline-primary w-100">New User Guide</a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="{% url 'user_guide' 'community_creation' %}" class="btn btn-outline-primary w-100">Community Guide</a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="{% url 'user_guide' 'post_creation' %}" class="btn btn-outline-primary w-100">Post Creation</a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="{% url 'user_guide' 'commenting' %}" class="btn btn-outline-primary w-100">Commenting</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const steps = [{% for step in steps %}{{ step.order }}{% if not forloop.last %}, {% endif %}{% endfor %}];
        let currentStep = 1;
        const guideType = "{{ guide_type }}";
        
        // Guide navigation buttons
        const startBtn = document.getElementById('guide-start');
        const prevBtn = document.getElementById('guide-prev');
        const nextBtn = document.getElementById('guide-next');
        const closeBtn = document.getElementById('guide-close');
        
        // Update guide based on current step
        function updateGuide() {
            // Hide all steps
            document.querySelectorAll('.guide-step').forEach(step => {
                step.style.display = 'none';
            });
            
            // Show current step
            const currentStepEl = document.getElementById(`step-${currentStep}`);
            if (currentStepEl) {
                currentStepEl.style.display = 'block';
            }
            
            // Update navigation buttons
            prevBtn.disabled = currentStep <= 1;
            nextBtn.disabled = currentStep >= steps.length;
        }
        
        // Event listeners for navigation buttons
        startBtn.addEventListener('click', function() {
            // Start the interactive guide
            if (typeof window.startUserGuide === 'function') {
                window.startUserGuide(guideType);
            } else {
                // Fallback if interactive guide is not available
                alert('Interactive guide not available. Please read the step-by-step guide on this page.');
            }
        });
        
        prevBtn.addEventListener('click', function() {
            if (currentStep > 1) {
                currentStep--;
                updateGuide();
            }
        });
        
        nextBtn.addEventListener('click', function() {
            if (currentStep < steps.length) {
                currentStep++;
                updateGuide();
            }
        });
        
        closeBtn.addEventListener('click', function() {
            window.location.href = "{% url 'home' %}";
        });
    });
</script>
{% endblock %}
