{% comment %}
  Template for the comment form
  
  Parameters:
  - post: The post being commented on (required)
  - parent_comment: The parent comment if replying to a comment (optional)
  - comment_form: The CommentForm instance (required)
  - card_class: Additional CSS classes for the card (optional)
  
  Usage:
  {% include 'core/includes/comment_form.html' with post=post comment_form=comment_form %}
{% endcomment %}

{% if user.is_authenticated %}
<section class="card {% if not parent_comment %}mb-4{% endif %} {{ card_class|default:'' }}" aria-labelledby="comment-form-heading">
    <div class="card-body p-3">
        <h2 id="comment-form-heading" class="sr-only">Add a comment</h2>
        <div class="d-flex align-items-center mb-3">
            {% if user.profile.avatar %}
                <img src="{{ user.profile.avatar.url }}" alt="{{ user.username }}'s avatar" class="rounded-circle me-2" style="width: 32px; height: 32px; object-fit: cover;">
            {% else %}
                <div class="avatar-placeholder rounded-circle me-2 d-flex align-items-center justify-content-center" style="width: 32px; height: 32px; background-color: #e9ecef;" aria-hidden="true">
                    <i class="bi bi-person-fill"></i>
                </div>
            {% endif %}
            <span>Comment as <a href="{% url 'profile' user.username %}" class="fw-bold">{{ user.username }}</a></span>
        </div>
        <form method="post" action="{% url 'add_comment' post.id %}">
            {% csrf_token %}
            {% if parent_comment %}
                <input type="hidden" name="parent_id" value="{{ parent_comment.id }}">
            {% endif %}
            <div class="mb-3">
                <label for="content_id_content" class="form-label sr-only">Comment text</label>
                {{ comment_form.content }}
            </div>
            <button type="submit" class="btn btn-primary">{% if parent_comment %}Reply{% else %}Comment{% endif %}</button>
            {% if parent_comment %}
                <button type="button" class="btn btn-outline-secondary cancel-reply-btn ms-2">Cancel</button>
            {% endif %}
        </form>
    </div>
</section>
{% else %}
<div class="alert alert-info mb-4">
    <p class="mb-0">
        Please <a href="{% url 'account_login' %}">log in</a> or <a href="{% url 'account_signup' %}">sign up</a> to leave a comment.
    </p>
</div>
{% endif %}