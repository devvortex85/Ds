{% load dict_tags %}

<!-- Nested comment rendering template -->
<article id="comment-{{ node.id }}" class="comment-item">
    <!-- Comment indentation markers - one for each level -->
    {% if level_adjustment %}
        {% with adjusted_level=node.level|add:level_adjustment %}
            {% for i in "12345"|make_list %}
                {% if forloop.counter <= adjusted_level %}
                    <div class="comment-indent indent-level-{{ forloop.counter }}"></div>
                {% endif %}
            {% endfor %}
        {% endwith %}
    {% else %}
        {% with level=node.level %}
            {% for i in "12345"|make_list %}
                {% if forloop.counter <= level %}
                    <div class="comment-indent indent-level-{{ forloop.counter }}"></div>
                {% endif %}
            {% endfor %}
        {% endwith %}
    {% endif %}
    
    <div class="comment-wrapper">
        <!-- Vote controls -->
        <div class="vote-column">
            {% with comment=node %}
                {% include 'core/includes/comment_rendering.html' %}
            {% endwith %}
        </div>
        
        <!-- Comment content -->
        <div class="comment-content-column">
            <div class="comment-meta">
                {% with comment=node %}
                    {% include 'core/includes/comment_author.html' %}
                {% endwith %}
            </div>
            
            <div class="comment-body">
                {{ node.content|linebreaks }}
            </div>
            
            {% include 'core/includes/comment_reply_form.html' with comment=node %}
        </div>
    </div>
</article>

<!-- For comments that reach the maximum nesting depth, show "Continue Thread" link -->
{% if max_depth and node.level >= max_depth and not node.is_leaf_node %}
    <div class="deep-nesting-indicator">
        <a href="{% url 'comment_thread' node.id %}" class="continue-thread-link">
            <i class="bi bi-arrow-right-circle-fill me-1" aria-hidden="true"></i>
            Continue this thread ({{ node.get_descendant_count }} more repl{% if node.get_descendant_count != 1 %}ies{% else %}y{% endif %})
        </a>
    </div>
{% endif %}