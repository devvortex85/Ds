{% load reputation_tags %}
{% load dict_tags %}
{% load mptt_tags %}

{# 
This partial template handles comment rendering across the application.
It consolidates code previously duplicated in reddit_comments.html and comment_thread.html
#}

{% if user.is_authenticated %}
<a href="{% url 'vote_comment' comment.id 'upvote' %}?next={{ request.path }}#comment-{{ comment.id }}" 
   class="vote-btn upvote-btn comment-vote-btn {% if user_comment_votes and comment.id in user_comment_votes and user_comment_votes|get_item:comment.id == 1 %}active voted{% endif %}"
   data-comment-id="{{ comment.id }}" 
   data-vote-type="upvote"
   aria-label="Upvote"
   role="button"
   tabindex="0">
    <i class="bi bi-arrow-up-short" aria-hidden="true"></i>
    <span class="sr-only">Upvote</span>
</a>
{% else %}
<a href="{% url 'account_login' %}" class="vote-btn" aria-label="Login to upvote">
    <i class="bi bi-arrow-up-short" aria-hidden="true"></i>
    <span class="sr-only">Login to upvote</span>
</a>
{% endif %}

<div class="vote-count" id="comment-{{ comment.id }}-votes" aria-live="polite" aria-label="Comment score: {{ comment.vote_count }}">{{ comment.vote_count }}</div>

{% if user.is_authenticated %}
<a href="{% url 'vote_comment' comment.id 'downvote' %}?next={{ request.path }}#comment-{{ comment.id }}" 
   class="vote-btn downvote-btn comment-vote-btn {% if user_comment_votes and comment.id in user_comment_votes and user_comment_votes|get_item:comment.id == -1 %}active voted{% endif %}"
   data-comment-id="{{ comment.id }}" 
   data-vote-type="downvote"
   aria-label="Downvote"
   role="button"
   tabindex="0">
    <i class="bi bi-arrow-down-short" aria-hidden="true"></i>
    <span class="sr-only">Downvote</span>
</a>
{% else %}
<a href="{% url 'account_login' %}" class="vote-btn" aria-label="Login to downvote">
    <i class="bi bi-arrow-down-short" aria-hidden="true"></i>
    <span class="sr-only">Login to downvote</span>
</a>
{% endif %}