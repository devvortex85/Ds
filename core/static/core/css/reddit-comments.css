/*
 * Reddit-style Comment System
 * Modern implementation of nested comments with collapsible threads
 */

/* Define color variables for nesting colors */
:root {
    /* Nesting level colors */
    --nesting-level-1: #5bc0de; /* Bootstrap info blue */
    --nesting-level-2: #f0ad4e; /* Bootstrap warning orange */
    --nesting-level-3: #5cb85c; /* Bootstrap success green */
    --nesting-level-4: #d9534f; /* Bootstrap danger red */
    --nesting-level-5: #a179f3; /* Purple */
    
    /* Nesting level glows */
    --nesting-glow-1: rgba(91, 192, 222, 0.3);
    --nesting-glow-2: rgba(240, 173, 78, 0.3);
    --nesting-glow-3: rgba(92, 184, 92, 0.3);
    --nesting-glow-4: rgba(217, 83, 79, 0.3);
    --nesting-glow-5: rgba(161, 121, 243, 0.3);
    
    /* Mobile nesting glows (more opaque) */
    --nesting-mobile-glow-1: rgba(91, 192, 222, 0.4);
    --nesting-mobile-glow-2: rgba(240, 173, 78, 0.4);
    --nesting-mobile-glow-3: rgba(92, 184, 92, 0.4);
    --nesting-mobile-glow-4: rgba(217, 83, 79, 0.4);
    --nesting-mobile-glow-5: rgba(161, 121, 243, 0.4);
}

/* Comment Container */
.comments-container {
    margin-top: calc(1rem * var(--adaptive-scale, 1));
}

/* Comment Thread - contains a comment and its replies */
.comment-thread {
    margin-bottom: calc(0.5rem * var(--adaptive-scale, 1));
    position: relative;
}

/* Root Comment */
.comment-item {
    position: relative;
    padding: calc(0.6rem * var(--adaptive-scale, 1));
    margin-bottom: calc(0.35rem * var(--adaptive-scale, 1));
    border-radius: calc(4px * var(--adaptive-scale, 1));
    background-color: var(--dark-card);
    transition: all 0.2s ease;
    border-left: calc(3px * var(--adaptive-scale, 1)) solid transparent; /* For nesting color indicators */
}

/* Add visual nesting depth indicators for deeper comments */
.comment-item[id^="comment-"] {
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

/* Apply different border colors based on nesting depth */
.nested-comments .comment-item {
    border-left-color: var(--nesting-level-1); /* Level 1: blue */
}

.nested-comments .nested-comments .comment-item {
    border-left-color: var(--nesting-level-2); /* Level 2: orange */
}

.nested-comments .nested-comments .nested-comments .comment-item {
    border-left-color: var(--nesting-level-3); /* Level 3: green */
}

.nested-comments .nested-comments .nested-comments .nested-comments .comment-item {
    border-left-color: var(--nesting-level-4); /* Level 4: red */
}

.nested-comments .nested-comments .nested-comments .nested-comments .nested-comments .comment-item {
    border-left-color: var(--nesting-level-5); /* Level 5: purple */
}

/* Comment styling when a user is replying to it */
.comment-item.replying-to {
    background-color: rgba(53, 126, 221, 0.12);
    box-shadow: 0 0 4px rgba(53, 126, 221, 0.2);
}

/* Comment wrapper - contains voting and content */
.comment-wrapper {
    display: flex;
}

/* Column for vote buttons */
.vote-column {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-right: calc(0.5rem * var(--adaptive-scale, 1));
    margin-right: calc(0.5rem * var(--adaptive-scale, 1));
}

/* Comment content column */
.comment-content-column {
    flex: 1;
    min-width: 0; /* Helps with text overflow */
}

/* Comment metadata */
.comment-meta {
    color: var(--dark-text-secondary);
    font-size: calc(0.75rem * var(--adaptive-scale, 1));
    margin-bottom: calc(0.25rem * var(--adaptive-scale, 1));
    display: flex;
    align-items: center;
    flex-wrap: wrap;
}

/* Author name in comments */
.comment-author {
    font-weight: 600;
    color: var(--dark-text-primary);
    text-decoration: none;
}

.comment-author:hover {
    text-decoration: underline;
}

/* Comment body text */
.comment-body {
    color: var(--dark-text-primary);
    word-break: break-word;
    margin-bottom: calc(0.5rem * var(--adaptive-scale, 1));
    font-size: calc(0.875rem * var(--adaptive-scale, 1));
    line-height: 1.5;
}

/* Comment actions (reply, etc) */
.comment-actions {
    display: flex;
    gap: calc(0.5rem * var(--adaptive-scale, 1));
    margin-top: calc(0.25rem * var(--adaptive-scale, 1));
}

.comment-action-btn {
    font-size: calc(0.75rem * var(--adaptive-scale, 1));
    color: var(--dark-text-secondary);
    background: none;
    border: none;
    padding: calc(0.25rem * var(--adaptive-scale, 1));
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    transition: color 0.2s ease;
}

.comment-action-btn:hover {
    color: var(--dark-text-primary);
}

.comment-action-btn .bi {
    margin-right: calc(0.25rem * var(--adaptive-scale, 1));
    font-size: calc(0.875rem * var(--adaptive-scale, 1));
}

/* Reply form */
.reply-form {
    margin-top: calc(0.5rem * var(--adaptive-scale, 1));
    background-color: var(--dark-surface);
    padding: calc(0.5rem * var(--adaptive-scale, 1));
    border-radius: calc(4px * var(--adaptive-scale, 1));
    display: none; /* Hidden by default */
}

.reply-form textarea {
    background-color: #2c2c2c;
    color: var(--dark-text-primary);
    border: calc(1px * var(--adaptive-scale, 1)) solid #444;
    border-radius: calc(4px * var(--adaptive-scale, 1));
    min-height: calc(80px * var(--adaptive-scale, 1));
    padding: calc(0.5rem * var(--adaptive-scale, 1));
    resize: vertical;
    width: 100%;
    font-size: calc(0.875rem * var(--adaptive-scale, 1));
}

.reply-form-actions {
    display: flex;
    justify-content: flex-end;
    margin-top: calc(0.5rem * var(--adaptive-scale, 1));
    gap: calc(0.5rem * var(--adaptive-scale, 1));
}

/* ===== REDDIT-STYLE NESTING ===== */

/* Nested comments container */
.nested-comments {
    position: relative;
    margin-left: calc(2rem * var(--adaptive-scale, 1)); /* Increased margin for better visual nesting */
    transition: all 0.3s ease-in-out;
}

/* Thread collapse line - shows vertical line for collapsible threads */
.thread-collapse-line {
    position: absolute;
    left: calc(-1.25rem * var(--adaptive-scale, 1)); /* Adjusted position */
    top: 0;
    bottom: 0;
    width: calc(3px * var(--adaptive-scale, 1)); /* Thicker line for better visibility */
    background-color: #444;
    cursor: pointer;
    transition: background-color 0.3s ease, width 0.2s ease;
    border-radius: calc(3px * var(--adaptive-scale, 1)); /* Rounded edges */
}

.thread-collapse-line:hover {
    background-color: var(--primary-color);
    width: calc(4px * var(--adaptive-scale, 1)); /* Wider on hover for better UX */
}

/* Indentation markers for each nesting level */
.comment-indent {
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: calc(3px * var(--adaptive-scale, 1)); /* Thicker for better visibility */
    transition: all 0.2s ease;
    border-radius: calc(3px * var(--adaptive-scale, 1)); /* Rounded edges */
    opacity: 0.8; /* Slightly transparent for visual depth */
}

/* Enhanced colors for different nesting levels with distinct visualization */
.indent-level-1 { 
    background-color: var(--nesting-level-1); /* Bootstrap info blue */
    left: 0;
    box-shadow: 0 0 calc(4px * var(--adaptive-scale, 1)) var(--nesting-glow-1); /* Subtle glow */
}
.indent-level-2 { 
    background-color: var(--nesting-level-2); /* Bootstrap warning orange */
    left: calc(0.5rem * var(--adaptive-scale, 1)); /* Increased spacing */
    box-shadow: 0 0 calc(4px * var(--adaptive-scale, 1)) var(--nesting-glow-2);
}
.indent-level-3 { 
    background-color: var(--nesting-level-3); /* Bootstrap success green */
    left: calc(1rem * var(--adaptive-scale, 1));
    box-shadow: 0 0 calc(4px * var(--adaptive-scale, 1)) var(--nesting-glow-3);
}
.indent-level-4 { 
    background-color: var(--nesting-level-4); /* Bootstrap danger red */
    left: calc(1.5rem * var(--adaptive-scale, 1));
    box-shadow: 0 0 calc(4px * var(--adaptive-scale, 1)) var(--nesting-glow-4);
}
.indent-level-5 { 
    background-color: var(--nesting-level-5); /* Purple */
    left: calc(2rem * var(--adaptive-scale, 1));
    box-shadow: 0 0 calc(4px * var(--adaptive-scale, 1)) var(--nesting-glow-5);
}

/* Limit indicators for deeply nested comments */
.deep-nesting-indicator {
    color: var(--dark-text-secondary);
    font-size: calc(0.75rem * var(--adaptive-scale, 1));
    margin: calc(0.5rem * var(--adaptive-scale, 1)) 0;
    padding-left: calc(1.5rem * var(--adaptive-scale, 1));
}

/* Collapsed thread styling */
.comment-thread.collapsed .nested-comments {
    display: none;
}

.comment-thread.collapsed .comment-item {
    opacity: 0.85; /* Increased from 0.75 for better visibility */
    background-color: rgba(40, 40, 40, 0.5); /* Slightly darker when collapsed */
    transition: all 0.3s ease;
}

.comment-thread.collapsed .thread-collapse-line {
    background-color: var(--primary-color);
    width: calc(4px * var(--adaptive-scale, 1)); /* Thicker to indicate collapsed state */
    box-shadow: 0 0 calc(5px * var(--adaptive-scale, 1)) var(--nesting-mobile-glow-1); /* Glow effect for collapsed state */
}

.collapse-indicator {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin-right: calc(0.25rem * var(--adaptive-scale, 1));
    transition: all 0.3s ease;
    color: var(--nesting-level-1); /* Blue color for better visibility */
}

.comment-thread.collapsed .collapse-indicator {
    transform: rotate(-90deg);
    color: var(--primary-color); /* Change color when collapsed */
}

/* Comment count for collapsed threads */
.collapsed-count {
    display: none;
    font-size: calc(0.75rem * var(--adaptive-scale, 1));
    color: var(--dark-text-secondary);
    margin-top: calc(0.25rem * var(--adaptive-scale, 1));
    padding: calc(0.25rem * var(--adaptive-scale, 1)) calc(0.5rem * var(--adaptive-scale, 1));
    background-color: rgba(40, 40, 40, 0.3);
    border-radius: calc(4px * var(--adaptive-scale, 1));
    transition: all 0.3s ease;
}

.comment-thread.collapsed .collapsed-count {
    display: inline-block;
    border-left: calc(2px * var(--adaptive-scale, 1)) solid var(--primary-color);
}

/* Loading indicator for async loading of deep comments */
.comments-loading {
    text-align: center;
    padding: calc(1rem * var(--adaptive-scale, 1));
    color: var(--dark-text-secondary);
    font-size: calc(0.875rem * var(--adaptive-scale, 1));
}

/* Continue thread link for very deep threads */
.continue-thread-link {
    display: block;
    padding: calc(0.5rem * var(--adaptive-scale, 1));
    margin-top: calc(0.5rem * var(--adaptive-scale, 1));
    text-align: center;
    color: var(--primary-color);
    background-color: var(--dark-surface);
    border-radius: calc(4px * var(--adaptive-scale, 1));
    text-decoration: none;
    font-size: calc(0.875rem * var(--adaptive-scale, 1));
}

.continue-thread-link:hover {
    background-color: var(--dark-hover);
}

/* Mobile optimizations */
@media (max-width: 576px) {
    .comment-wrapper {
        flex-direction: column;
    }
    
    .vote-column {
        flex-direction: row;
        margin-bottom: calc(0.5rem * var(--adaptive-scale, 1));
        padding-right: 0;
    }
    
    .vote-btn {
        padding: calc(0.25rem * var(--adaptive-scale, 1)) calc(0.5rem * var(--adaptive-scale, 1));
    }
    
    .vote-count {
        margin: 0 calc(0.5rem * var(--adaptive-scale, 1));
    }
    
    .nested-comments {
        margin-left: calc(0.85rem * var(--adaptive-scale, 1));
    }
    
    .thread-collapse-line {
        left: calc(-0.65rem * var(--adaptive-scale, 1));
        width: calc(2px * var(--adaptive-scale, 1));
    }
    
    .comment-indent {
        width: calc(2px * var(--adaptive-scale, 1));
        opacity: 0.9; /* More opaque on mobile for visibility */
    }
    
    /* Adjusted mobile spacing for better readability */
    .indent-level-1 { 
        left: 0; 
        box-shadow: 0 0 calc(2px * var(--adaptive-scale, 1)) var(--nesting-mobile-glow-1);
    }
    .indent-level-2 { 
        left: calc(0.2rem * var(--adaptive-scale, 1)); 
        box-shadow: 0 0 calc(2px * var(--adaptive-scale, 1)) var(--nesting-mobile-glow-2);
    }
    .indent-level-3 { 
        left: calc(0.4rem * var(--adaptive-scale, 1));
        box-shadow: 0 0 calc(2px * var(--adaptive-scale, 1)) var(--nesting-mobile-glow-3);
    }
    .indent-level-4 { 
        left: calc(0.6rem * var(--adaptive-scale, 1));
        box-shadow: 0 0 calc(2px * var(--adaptive-scale, 1)) var(--nesting-mobile-glow-4);
    }
    .indent-level-5 { 
        left: calc(0.8rem * var(--adaptive-scale, 1));
        box-shadow: 0 0 calc(2px * var(--adaptive-scale, 1)) var(--nesting-mobile-glow-5);
    }
    
    /* Enhancement for touch targets */
    .thread-collapse-line:hover,
    .thread-collapse-line:active {
        width: calc(6px * var(--adaptive-scale, 1)); /* Wider for easier targeting on touch screens */
    }
}

/* Animation for collapsing/expanding */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes fadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
}

.nested-comments.animate-in {
    animation: fadeIn 0.3s ease forwards;
}

.nested-comments.animate-out {
    animation: fadeOut 0.3s ease forwards;
}